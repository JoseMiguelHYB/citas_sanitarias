<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>Panel Paciente</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body { background-color: #f2fdfc; }
    .main-card { background: #fff; border-radius: 12px; padding: 2rem; box-shadow: 0 4px 10px rgba(0,0,0,.1); border-top: 6px solid #009688; }
    .bienvenida h1 { color: #009688; font-weight: bold; }
    .list-group a:hover { background-color: #b2dfdb; color: #004d40; }
    .menu-card { max-width: 960px; margin-inline: auto; }
    .content-card { background: #fff; border-radius: 12px; padding: 1.25rem; box-shadow: 0 4px 10px rgba(0,0,0,.06); border: 1px solid #e8f3f2; }
    .content-header { color:#00695c; font-weight: 700; }
    .muted { color:#6b7c7a; }
    .empty { border:2px dashed #cfe9e7; border-radius: 12px; padding: 1.25rem; text-align: center; color:#5e6b6a; }
  </style>
</head>
<body>
  <div class="container my-5 menu-card">
    <div class="main-card">
      <!-- Bienvenida -->
      <div class="text-center bienvenida mb-4">
        <h1>üôé‚Äç‚ôÇÔ∏è ¬°Hola, <span th:text="${paciente.nombre}">Paciente</span>!</h1>
        <p>Bienvenido a tu panel personal. Desde aqu√≠ puedes gestionar f√°cilmente tus citas m√©dicas.</p>
      </div>

      <!-- Men√∫ -->
	  <div class="list-group mb-4">
	      <a th:href="@{/citas/crear}" class="list-group-item list-group-item-action d-flex align-items-center">
	          <span class="fs-3 me-3">‚ûï</span>
	          <div>
	              <h5 class="mb-1">Crear Cita</h5>
	              <small>Programa una nueva consulta m√©dica.</small>
	          </div>
	      </a>

	      <!--<a th:href="@{/citas/mis_citas}" class="list-group-item list-group-item-action d-flex align-items-center">
	          <span class="fs-3 me-3">üìã</span>
	          <div>
	              <h5 class="mb-1">Ver Mis Citas</h5>
	              <small>Consulta todas tus citas agendadas.</small>
	          </div>
	      </a>

	      <a th:href="@{/citas/actualizar}" class="list-group-item list-group-item-action d-flex align-items-center">
	          <span class="fs-3 me-3">‚úèÔ∏è</span>
	          <div>
	              <h5 class="mb-1">Actualizar Cita</h5>
	              <small>Edita la informaci√≥n de una cita existente.</small>
	          </div>
	      </a>

	      <a th:href="@{/citas/eliminar}" class="list-group-item list-group-item-action d-flex align-items-center text-danger">
	          <span class="fs-3 me-3">üóëÔ∏è</span>
	          <div>
	              <h5 class="mb-1">Eliminar Cita</h5>
	              <small>Cancela una cita que ya no necesites.</small>
	          </div>
	      </a>
	  </div>-->



      <!-- Contenido din√°mico -->
      <div class="content-card">
        <!-- CREAR CITA -->
        <!--<section id="view-crear" class="spa-view" aria-labelledby="title-crear">
          <h3 id="title-crear" class="content-header mb-3">Crear nueva cita</h3>
          <form class="row g-3" method="post" th:action="@{/citas/register}">
            
             ESPECIALIDAD
            <div class="col-md-6">
              <label class="form-label">Especialidad</label>
              <select class="form-select" name="especialidad" required>
                <option value="" disabled selected>Selecciona una especialidad</option>
                <option th:each="medico : ${medicos}" 
                        th:value="${medico.especialidad}" 
                        th:text="${medico.especialidad}">
                </option>
              </select>
            </div>

            M√âDICO 
            <div class="col-md-6">
              <label class="form-label">M√©dico</label>
              <select class="form-select" name="medicoId" required>
                <option value="" disabled selected>Selecciona un m√©dico</option>
                <option th:each="medico : ${medicos}" 
                        th:value="${medico.id}" 
                        th:text="${medico.nombre}">
                </option>
              </select>
            </div>

            FECHA 
            <div class="col-md-4">
              <label class="form-label">Fecha</label>
              <input type="date" class="form-control" name="fecha" required />
            </div>

            HORA
            <div class="col-md-4">
              <label class="form-label">Hora</label>
              <input type="time" class="form-control" name="hora" required />
            </div>

            MODALIDAD
            <div class="col-md-4">
              <label class="form-label">Modalidad</label>
              <select class="form-select" name="tipoConsulta" required>
                <option value="Presencial">Presencial</option>
                <option value="Videoconsulta">Videoconsulta</option>
              </select>
            </div>

             MOTIVO
            <div class="col-12">
              <label class="form-label">Motivo</label>
              <textarea class="form-control" rows="3" name="motivo"></textarea>
            </div>

            BOTONES
            <div class="col-12 d-flex gap-2">
              <button type="submit" class="btn btn-success">Guardar cita</button>
              <button type="reset" class="btn btn-outline-secondary">Limpiar</button>
            </div>
          </form>
        </section>-->

        <!-- MIS CITAS -->
        <section id="view-mis-citas" class="spa-view d-none">
          <h3 class="content-header mb-3">Mis citas</h3>
          <div class="table-responsive">
            <table class="table align-middle">
              <thead>
                <tr>
                  <th>Fecha</th><th>Hora</th><th>Especialidad</th><th>M√©dico</th><th>Estado</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="cita : ${citas}">
                  <td th:text="${cita.fecha}"></td>
                  <td th:text="${cita.hora}"></td>
                  <td th:text="${cita.especialidad}"></td>
                  <td th:text="${cita.medico.nombre}"></td>
                  <td><span class="badge" th:text="${cita.estado}"></span></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="empty mt-3" th:if="${#lists.isEmpty(citas)}">
            Aqu√≠ aparecer√°n tus citas cuando tengas alguna registrada.
          </div>
        </section>

        <!-- ACTUALIZAR CITA -->
        <section id="view-actualizar" class="spa-view d-none">
          <h3 class="content-header mb-3">Actualizar una cita</h3>
          <form class="row g-3" method="post" th:action="@{/citas/actualizar}">
            <div class="col-md-4">
              <label class="form-label">ID de la cita</label>
              <input class="form-control" name="id" required />
            </div>
            <div class="col-md-4">
              <label class="form-label">Nueva fecha</label>
              <input type="date" class="form-control" name="fecha" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Nueva hora</label>
              <input type="time" class="form-control" name="hora" />
            </div>
            <div class="col-md-4">
              <label class="form-label">Estado</label>
              <select class="form-select" name="estado">
                <option>Programada</option>
                <option>Reprogramada</option>
                <option>Cancelada</option>
              </select>
            </div>
            <div class="col-12 d-flex gap-2">
              <button class="btn btn-warning">Guardar cambios</button>
              <button type="reset" class="btn btn-outline-secondary">Cancelar</button>
            </div>
          </form>
        </section>

        <!-- ELIMINAR CITA -->
        <section id="view-eliminar" class="spa-view d-none">
          <h3 class="content-header mb-3 text-danger">Eliminar una cita</h3>
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between align-items-center" th:each="cita : ${citas}">
              <span th:text="${cita.fecha} + ' ¬∑ ' + ${cita.hora} + ' ¬∑ ' + ${cita.especialidad}"></span>
              <form th:action="@{/citas/eliminar/{id}(id=${cita.id})}" method="post">
                <button class="btn btn-sm btn-outline-danger">Eliminar</button>
              </form>
            </li>
          </ul>
          <div class="alert alert-warning" th:if="${#lists.isEmpty(citas)}">
            No tienes citas disponibles para eliminar.
          </div>
        </section>
      </div>
    </div>

    <!-- Logout -->
    <div class="text-center mt-5">
      <form th:action="@{/paciente/logout}" method="post">
        <button class="btn btn-outline-success btn-lg">üö™ Cerrar sesi√≥n</button>
      </form>
    </div>
  </div>

  <footer class="text-center text-muted mb-4">¬© 2025 - Sistema de Gesti√≥n de Citas</footer>

  <!-- Toasts flotantes -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
    <div th:if="${successMessage}" 
         class="toast align-items-center text-bg-success border-0 show" 
         role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" th:text="${successMessage}"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
      </div>
    </div>
    <div th:if="${error}" 
         class="toast align-items-center text-bg-danger border-0 show" 
         role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" th:text="${error}"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Cerrar"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const routes = { '#crear': 'view-crear', '#mis-citas': 'view-mis-citas', '#actualizar': 'view-actualizar', '#eliminar': 'view-eliminar' };
    function showView(hash) {
      const target = routes[hash] || 'view-crear';
      document.querySelectorAll('.spa-view').forEach(v => v.classList.add('d-none'));
      document.getElementById(target).classList.remove('d-none');
      document.querySelectorAll('#spaMenu a').forEach(a => a.classList.remove('active'));
      const activeLink = document.querySelector(`#spaMenu a[href='${hash}']`);
      if (activeLink) activeLink.classList.add('active');
    }
    window.addEventListener('hashchange', () => showView(location.hash));
    window.addEventListener('DOMContentLoaded', () => {
      showView(location.hash || '#crear');
      // Activar toasts autom√°ticamente
      const toastElList = [].slice.call(document.querySelectorAll('.toast'));
      toastElList.forEach(function (toastEl) {
        new bootstrap.Toast(toastEl, { delay: 6000 }).show();
      });
    });
  </script>
</body>
</html>
